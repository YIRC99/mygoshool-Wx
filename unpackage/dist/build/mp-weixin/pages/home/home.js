(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/home"],{"5e31":function(e,t,n){"use strict";var r=n("a50f"),o=n.n(r);o.a},a25e:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return r}));var r={uTabs:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-tabs/u-tabs")]).then(n.bind(null,"2745"))},uvCalendars:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uv-calendars/components/uv-calendars/uv-calendars")]).then(n.bind(null,"9680"))},myEmppty:function(){return Promise.all([n.e("common/vendor"),n.e("components/myEmppty/myEmppty")]).then(n.bind(null,"7d7f"))},uniCard:function(){return n.e("uni_modules/uni-card/components/uni-card/uni-card").then(n.bind(null,"922e"))},uvPopup:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uv-popup/components/uv-popup/uv-popup")]).then(n.bind(null,"326c"))},uniSection:function(){return n.e("uni_modules/uni-section/components/uni-section/uni-section").then(n.bind(null,"43d2"))},quickMessage:function(){return Promise.all([n.e("common/vendor"),n.e("components/quick-message/quick-message")]).then(n.bind(null,"bb33"))},zeroLoading:function(){return n.e("uni_modules/zero-loading/components/zero-loading/zero-loading").then(n.bind(null,"0cb3"))},uvModal:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uv-modal/components/uv-modal/uv-modal")]).then(n.bind(null,"e1f9"))},uvUpload:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uv-upload/components/uv-upload/uv-upload")]).then(n.bind(null,"b80a"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.newSchoolList.length),r=e.__map(e.newSchoolList,(function(t,n){var r=e.__get_orig(t),o=e.subYear(t.startdatetime);return{$orig:r,m0:o}})),o=e.oldSchoolList.length,s=e.__map(e.oldSchoolList,(function(t,n){var r=e.__get_orig(t),o=e.subYear(t.startdatetime);return{$orig:r,m1:o}})),i=e.otherAddressList.length,c=e.__map(e.otherAddressList,(function(t,n){var r=e.__get_orig(t),o=e.subYear(t.startdatetime);return{$orig:r,m2:o}})),a=e._f("fromStartDateTime")(e.currentOrder.startdatetime),l=1==e.currentOrder.isbefore?e.hoursTominute(e.currentOrder.beforetime):null,u=1==e.currentOrder.isafter?e.hoursTominute(e.currentOrder.aftertime):null;e.$mp.data=Object.assign({},{$root:{g0:n,l0:r,g1:o,l1:s,g2:i,l2:c,f0:a,m3:l,m4:u}})},s=[]},a50f:function(e,t,n){},af96:function(e,t,n){"use strict";n.r(t);var r=n("e69e"),o=n.n(r);for(var s in r)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=o.a},ccfe:function(e,t,n){"use strict";n.r(t);var r=n("a25e"),o=n("af96");for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);n("5e31");var i=n("f0c5"),c=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=c.exports},d759:function(e,t,n){"use strict";(function(e,t){var r=n("4ea4");n("33e0");r(n("66fd"));var o=r(n("ccfe"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},e69e:function(e,t,n){"use strict";(function(e){var r=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("2eee")),s=r(n("448a")),i=r(n("9523")),c=r(n("c973")),a=r(n("2ee6"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={data:function(){return{resWximg:"",fileList1:[],isLoading:!1,oneRefresh:!1,isRefresh:!1,popupShow:!1,list:[{name:"濂溪校区",time:"",pageNum:1,pagetotal:0},{name:"鹤问湖校区",time:"",pageNum:1,pagetotal:0},{name:"其他",time:"",pageNum:1,pagetotal:0}],currentIndex:0,orderList:[],newSchoolList:[],oldSchoolList:[],otherAddressList:[],currentOrder:{createUserInfo:{username:"",userphone:"",userwx:""},phonenumber:"",wechataccount:"",orderid:"",wechatImg:"",startdatetime:""},pageNum:1,pageSize:5,pagetotal:0,info:{}}},created:function(){this.info=e.getStorageSync("user")},mixins:[a.default],methods:{ToUserInfo:function(){console.log("点击了 个人信息"),e.navigateTo({url:"/subpkg/userinfo?userid="+this.currentOrder.createUserInfo.userid})},confirmWxImg:function(){0!=this.fileList1.length?"success"==this.fileList1[0].status?(this.fileList1=[],this.receiveOrder()):this.$refs.message.show({type:"error",msg:"请图片上传成功后确定"}):this.$refs.message.show({type:"error",msg:"请上传图片后确定"})},cancelWxImg:function(){this.fileList1=[]},clickUploadImgM:function(){this.fileList1.length>=1||this.$refs.uploadWxImgRef.chooseFile()},overSize:function(){this.$refs.message.show({type:"error",msg:"图片超过3MB大小"})},uploadFilePromise:function(t){var n=this;return new Promise((function(r,o){e.uploadFile({url:n.http+"common/upload?path=QRcode",filePath:t,name:"file",formData:{user:"test"},timeout:5e3,success:function(e){console.log("上传成功",e.statusCode),n.isUploadWximg=!0;var t=JSON.parse(e.data).data;n.resWximg=t,r(200)},fail:function(e){console.log("上传失败",e),r(400)}})}))},afterRead:function(t){var n=this;return(0,c.default)(o.default.mark((function r(){var s,i,a,l;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:for(s=[].concat(t.file),i=n["fileList".concat(t.name)].length,s.map((function(e){n["fileList".concat(t.name)].push(u(u({},e),{},{status:"uploading",message:"上传中"}))})),console.log(n.fileList1),a=function(r){console.log("还没有调用上传方法",s),e.compressImage({src:s[r].url,quality:70,success:function(){var e=(0,c.default)(o.default.mark((function e(c){var a,l;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(c.tempFilePath),console.log("压缩完成了"),s[r].url=c.tempFilePath,e.next=5,n.uploadFilePromise(s[r].url);case 5:a=e.sent,l=n["fileList".concat(t.name)][i],400==a?n["fileList".concat(t.name)].splice(i,1,Object.assign(l,{status:"failed",message:"请重新上传",url:a})):n["fileList".concat(t.name)].splice(i,1,Object.assign(l,{status:"success",message:"",url:a})),i++;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})},l=0;l<s.length;l++)a(l);case 6:case"end":return r.stop()}}),r)})))()},deletePic:function(e){this["fileList".concat(e.name)].splice(e.index,1),this.isUploadWximg=!1},viewWxImg:function(){var t=this.QRttp+this.currentOrder.wechatImg;e.previewImage({urls:[t]})},deleteArrById:function(e){if(0==this.currentIndex){for(var t=0;t<this.newSchoolList.length;t++)if(this.newSchoolList[t].orderid==e){this.newSchoolList.splice(t,1);break}}else if(1==this.currentIndex){for(t=0;t<this.oldSchoolList.length;t++)if(this.oldSchoolList[t].orderid==e){this.oldSchoolList.splice(t,1);break}}else if(2==this.currentIndex)for(t=0;t<this.otherAddressList.length;t++)if(this.otherAddressList[t].orderid==e){this.otherAddressList.splice(t,1);break}},chooseDateConfirm:function(e){console.log(e.fulldate),this.list[this.currentIndex].time=e.fulldate,console.log("this.list[this.currentIndex].time",this.list[this.currentIndex].time),console.log("点击确定 筛选日期"),this.scrollPullDown()},cancelCalendars:function(){console.log("点击取消 清空日期"),this.list[this.currentIndex].time="",this.scrollPullDown()},openCalendars:function(){this.$refs.calendars.open()},copyWx:function(){var t=this;e.setClipboardData({data:this.currentOrder.wechataccount||this.currentOrder.phonenumber,complete:function(e){console.log("点击复制的结果",e),t.$refs.receivePopup.close(),t.closeReceivePopup()}})},closeReceivePopup:function(){this.popupShow=!1},showUploadWxImg:function(){this.$refs.modal.open()},receiveOrder:function(){var t=this,n=e.getStorageSync("user");this.isLoading=!0,this.post({url:"carshareorder/receive",data:{orderid:this.currentOrder.orderid,receiveuserid:n.openid,createuserid:this.currentOrder.createuserid,receiveUserWechatImg:this.resWximg}}).then((function(e){if(console.log(e),200!=e.code)return t.$refs.message.show({type:"error",msg:"订单已被接受或失效",iconSize:16}),t.popupShow=!1,t.isLoading=!1,t.$refs.popup.close(),void t.scrollPullDown();t.isLoading=!1,t.scrollPullDown(),t.$refs.popup.close(),t.$refs.receivePopup.open()})).catch((function(e){console.log("home page is",e),t.isRefresh=!1,t.$refs.message.show({type:"error",msg:"网络开了点小差,请稍候重试吧",iconSize:16})}))},getOrderList:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&(this.list[this.currentIndex].pageNum=1),this.post({url:"carshareorder/page",data:{pageNum:this.list[this.currentIndex].pageNum,pageSize:this.pageSize,pageDate:this.list[this.currentIndex].time,startAddName:this.list[this.currentIndex].name}}).then((function(n){if(console.log(n.data),200!=n.code)return e.isRefresh=!1,void e.$refs.message.show({type:"error",msg:"网络开了点小差,请稍候重试吧",iconSize:16});e.list[e.currentIndex].pagetotal=n.data.total,n.data.records.forEach((function(e){(-1!=e.startaddressall.indexOf("濂溪校区")||-1!=e.startaddressall.indexOf("鹤问湖校区"))&&(e.startaddress="九职大"+e.startaddress.slice(6,9999))})),t?0==e.currentIndex?(e.newSchoolList=[],e.newSchoolList=n.data.records):1==e.currentIndex?(e.oldSchoolList=[],e.oldSchoolList=n.data.records):2==e.currentIndex&&(e.otherAddressList=[],e.otherAddressList=n.data.records):(console.log("获取信息是的方式是触底分页加载"),0==e.currentIndex?e.newSchoolList=[].concat((0,s.default)(e.newSchoolList),(0,s.default)(n.data.records)):1==e.currentIndex?e.oldSchoolList=[].concat((0,s.default)(e.oldSchoolList),(0,s.default)(n.data.records)):2==e.currentIndex&&(e.otherAddressList=[].concat((0,s.default)(e.otherAddressList),(0,s.default)(n.data.records)))),e.isRefresh=!1,console.log("下拉刷新结束了")})).catch((function(t){console.log("home page is",t),e.isRefresh=!1,e.$refs.message.show({type:"error",msg:"网络开了点小差,请稍候重试吧",iconSize:16})}))},scrollPullDown:function(){1!=this.isRefresh&&(this.isRefresh=!0,this.getOrderList())},scrollDown:function(){console.log("滚动条到了底部 当前的indedx为",this.currentIndex),0==this.currentIndex&&this.newSchoolList.length>=this.list[this.currentIndex].pagetotal?this.$refs.message.show({type:"default",msg:"已经到底了, 没有更多数据啦",iconSize:16}):1==this.currentIndex&&this.oldSchoolList.length>=this.list[this.currentIndex].pagetotal||2==this.currentIndex&&this.otherAddressList.length>=this.list[this.currentIndex].pagetotal?this.$refs.message.show({type:"success",msg:"已经到底了, 没有更多数据啦",iconSize:16}):(this.list[this.currentIndex].pageNum++,this.getOrderList(!1))},toAddOrder:function(){var t=e.getStorageSync("user");null!=t&&""!=t&&void 0!=t?e.navigateTo({url:"/subpkg/addCarorder"}):this.$refs.message.show({type:"error",msg:"请登录后再发布拼车吧",iconSize:16})},clickCard:function(e){this.currentOrder=e,console.log("点击了卡片当前选中改变了",this.currentOrder),this.$refs.popup.open(),this.popupShow=!0},closePopup:function(){this.popupShow=!1},change:function(e){if(this.currentIndex=e.index,0==this.currentIndex){if(0!==this.newSchoolList.length)return;this.scrollPullDown()}else if(1==this.currentIndex){if(0!==this.oldSchoolList.length)return;this.scrollPullDown()}else if(2==this.currentIndex){if(0!==this.otherAddressList.length)return;this.scrollPullDown()}},myonshow:function(){var t=this;e.$once("addUpdate",(function(){t.scrollPullDown()})),this.simulateSwipeDown()},simulateSwipeDown:function(){this.oneRefresh||(this.oneRefresh=!0,console.log("首次进入页面 index 0 页面 自动下拉刷新"),this.change({index:0,name:"濂溪校区"}))}}};t.default=d}).call(this,n("543d")["default"])}},[["d759","common/runtime","common/vendor"]]]);